# Vision Assistant Pro — Документация

**Vision Assistant Pro** — это продвинутый, многомодальный ИИ-ассистент для NVDA. Он использует модели Gemini от Google для предоставления интеллектуального чтения с экрана, перевода, голосового ввода и анализа документов.

_Это дополнение было выпущено для сообщества в честь Международного дня людей с ограниченными возможностями._

## 1. Настройка и конфигурация

Перейдите в **Меню NVDA > Параметры > Настройки > Vision Assistant Pro**.

- **Ключ API:** Обязателен. Вы можете ввести несколько ключей (разделяя запятыми или новыми строками). Ассистент будет автоматически переключаться между ними при достижении лимита квоты.
- **Модель ИИ:** Выберите между моделями **Flash** (самая быстрая/бесплатная), **Lite** или **Pro** (высокая интеллектуальность).
- **URL прокси:** По желанию. Используйте, если Google заблокирован в вашем регионе. Это должен быть веб-адрес, который выступает в качестве моста к API Gemini.
- **Движок OCR:** Выберите между **Chrome (быстрый)** для быстрых результатов или **Gemini (форматированный)** для лучшего сохранения разметки и распознавания таблиц.
- **Голос TTS:** Выберите предпочитаемый стиль голоса для генерации аудиофайлов из страниц документа.
- **Умная замена:** Автоматически меняет языки местами, если исходный текст соответствует целевому языку.
- **Прямой вывод:** Пропускает окно чата и сразу озвучивает ответ ИИ через синтезатор речи.
- **Интеграция с буфером обмена:** Автоматически копирует ответ ИИ в буфер обмена.

## 2. Командный слой и сочетания клавиш

Чтобы избежать конфликтов клавиш, это дополнение использует **Командный слой**.
1. Нажмите **NVDA + Shift + V** (главная клавиша), чтобы активировать слой (вы услышите звуковой сигнал).
2. Отпустите клавиши, затем нажмите одну из следующих одиночных клавиш:

| Клавиша         | Функция                      | Описание                                                                 |
|-----------------|------------------------------|-------------------------------------------------------------------------|
| **T**           | Умный переводчик             | Переводит текст под курсором навигатора или выделенный текст.           |
| **Shift + T**   | Перевод из буфера обмена     | Переводит содержимое, находящееся в настоящее время в буфере обмена.     |
| **R**           | Улучшение текста             | Суммаризировать, исправить грамматику, объяснить или запустить **Пользовательские запросы**. |
| **V**           | Распознавание объектов       | Описывает текущий объект навигатора.                                    |
| **O**           | Распознавание всего экрана   | Анализирует всю компоновку и содержимое экрана.                         |
| **Shift + V**   | Анализ онлайн-видео          | Анализирует видео с **YouTube**, **Instagram** или **Twitter (X)** по URL. |
| **D**           | Читатель документов          | Продвинутый читатель для PDF и изображений с выбором диапазона страниц. |
| **F**           | OCR файла                    | Прямое распознавание текста из выбранных файлов изображений, PDF или TIFF. |
| **A**           | Аудио-транскрипция           | Транскрибирует файлы MP3, WAV или OGG в текст.                          |
| **C**           | Решатель CAPTCHA             | Захватывает и решает CAPTCHA на экране или объекте навигатора.          |
| **S**           | Умный диктант                | Преобразует речь в текст. Нажмите, чтобы начать запись, ещё раз — чтобы остановить/ввести. |
| **L**           | Отчёт о состоянии            | Озвучивает текущий прогресс (например, "Сканирование...", "Ожидание").  |
| **U**           | Проверка обновлений          | Вручную проверить наличие последней версии дополнения на GitHub.        |
| **H**           | Справка по командам          | Отображает список всех доступных сочетаний клавиш внутри командного слоя. |

### 2.1 Сочетания клавиш читателя документов (внутри просмотрщика)
После открытия документа через команду **D**:
- **Ctrl + PageDown:** Перейти на следующую страницу (озвучивает номер страницы).
- **Ctrl + PageUp:** Перейти на предыдущую страницу (озвучивает номер страницы).
- **Alt + A:** Открыть диалог чата, чтобы задать вопросы о документе.
- **Alt + R:** Принудительно пересканировать текущую страницу или все страницы с помощью движка Gemini.
- **Alt + G:** Сгенерировать и сохранить высококачественный аудиофайл (WAV) из содержимого.
- **Alt + S / Ctrl + S:** Сохранить извлечённый текст в виде файла TXT или HTML.

## 3. Пользовательские запросы и переменные

Вы можете создавать мощные пользовательские команды ИИ в настройках, используя формат: `Имя:Текст запроса` (разделяйте несколько команд с помощью `|` или новой строки).

### Доступные переменные

| Переменная       | Описание                                      | Тип ввода          |
|------------------|-----------------------------------------------|--------------------|
| `[selection]`    | В настоящее время выделенный текст            | Текст              |
| `[clipboard]`    | Содержимое буфера обмена                      | Текст              |
| `[screen_obj]`   | Скриншот объекта навигатора                   | Изображение        |
| `[screen_full]`  | Скриншот всего экрана                         | Изображение        |
| `[file_ocr]`     | Выбрать файл изображения/PDF для извлечения текста | Изображение, PDF, TIFF |
| `[file_read]`    | Выбрать документ для чтения                   | TXT, Код, PDF      |
| `[file_audio]`   | Выбрать аудиофайл для анализа                 | MP3, WAV, OGG      |

### Примеры пользовательских запросов

- **Быстрый OCR:** `Мой OCR:[file_ocr]`
- **Перевод изображения:** `Перевод изображения:Извлеки текст из этого изображения и переведи на английский. [file_ocr]`
- **Анализ аудио:** `Суммаризация аудио:Прослушайте эту запись и выделите основные моменты. [file_audio]`
- **Отладчик кода:** `Отладка:Найди ошибки в этом коде и объясни их: [selection]`

***
**Примечание:** Для всех функций ИИ требуется активное интернет-соединение. Многостраничные документы и файлы TIFF обрабатываются автоматически.

## Изменения в версии 4.0
*   **Продвинутый читатель документов:** Мощный новый просмотрщик для PDF и изображений с выбором диапазона страниц, фоновой обработкой и удобной навигацией с помощью `Ctrl+PageUp/Down`.
*   **Новое подменю "Инструменты":** Добавлено специальное подменю "Vision Assistant" в меню "Инструменты" NVDA для более быстрого доступа к основным функциям, настройкам и документации.
*   **Гибкая настройка:** Теперь вы можете выбрать предпочитаемый движок OCR и голос TTS непосредственно из панели настроек.
*   **Поддержка нескольких ключей API:** Добавлена поддержка нескольких ключей API Gemini для обеспечения непрерывной работы. Вы можете вводить по одному ключу на строку или разделять их запятыми в настройках.
*   **Альтернативный движок OCR:** Представлен новый движок OCR для обеспечения надёжного распознавания текста даже при достижении лимитов квоты API Gemini.
*   **Умная ротация ключей API:** Автоматически переключается на самый быстрый работающий ключ API и запоминает его, чтобы обходить лимиты квот без ручного вмешательства.
*   **Преобразование документа в аудио:** Интегрирована возможность генерировать и сохранять высококачественные аудиофайлы (WAV) из страниц документа непосредственно в читателе.
*   **Переработанное диалоговое окно обновления:** Обновлённый доступный интерфейс с прокручиваемым текстовым полем для чёткого ознакомления с изменениями версии перед установкой.
*   **Унифицированный статус и UX:** Стандартизированы диалоги выбора файлов по всему дополнению, а также улучшена команда 'L' для отчёта о прогрессе в реальном времени для всех фоновых задач.

## Изменения в версии 3.6.0
*   **Система справки:** Добавлена команда справки (`H`) внутри Командного слоя, предоставляющая лёгкий доступ к списку всех сочетаний клавиш и их функций.
*   **Анализ онлайн-видео:** Расширена поддержка для включения видео с **Twitter (X)**. Также улучшено обнаружение URL и стабильность для более надёжной работы.
*   **Вклад в проект:** Добавлен опциональный диалог пожертвований для пользователей, желающих поддержать будущие обновления и непрерывное развитие проекта.

## Изменения в версии 3.5.0
\*   \*\*Командный слой:\*\* Представлена система Командного слоя (по умолчанию: `NVDA+Shift+V`) для группировки сочетаний клавиш под одной главной клавишей. Например, вместо нажатия `NVDA+Control+Shift+T` для перевода теперь нужно нажать `NVDA+Shift+V`, а затем `T`.
\*   \*\*Анализ онлайн-видео:\*\* Добавлена новая функция для анализа видео с YouTube и Instagram напрямую по предоставленному URL.

## Изменения в версии 3.1.0
*   **Режим прямого вывода:** Добавлена опция пропускать диалог чата и сразу слышать ответы ИИ через речь для более быстрого и плавного взаимодействия.
*   **Интеграция с буфером обмена:** Добавлена новая настройка для автоматического копирования ответов ИИ в буфер обмена.

## Изменения в версии 3.0

*   **Новые языки:** Добавлены переводы на **персидский** и **вьетнамский**.
*   **Расширенные модели ИИ:** Реорганизован список выбора моделей с чёткими префиксами (`[Бесплатно]`, `[Pro]`, `[Авто]`), чтобы помочь пользователям различать бесплатные и ограниченные (платные) модели. Добавлена поддержка **Gemini 3.0 Pro** и **Gemini 2.0 Flash Lite**.
*   **Стабильность диктанта:** Значительно улучшена стабильность Умного диктанта. Добавлена проверка безопасности для игнорирования аудиоклипов короче 1 секунды, предотвращая "галлюцинации" ИИ и пустые ошибки.
*   **Работа с файлами:** Исправлена проблема, при которой загрузка файлов с именами не на английском языке могла завершиться неудачей.
*   **Оптимизация запросов:** Улучшена логика перевода и структурирования результатов распознавания.

## Изменения в версии 2.9

*   **Добавлены переводы на французский и турецкий языки.**
*   **Форматированный вид:** Добавлена кнопка "Показать форматированное" в диалогах чата для просмотра беседы с правильным стилем (Заголовки, Жирный, Код) в стандартном просматриваемом окне.
*   **Настройка Markdown:** Добавлена новая опция "Очищать Markdown в чате" в настройках. Снятие этой галочки позволяет пользователям видеть необработанный синтаксис Markdown (например, `**`, `#`) в окне чата.
*   **Управление диалогами:** Исправлена проблема, при которой окна "Улучшить текст" или чата могли открываться несколько раз или не получали фокус корректно.
*   **Улучшения UX:** Стандартизированы заголовки диалоговых окон файлов на "Открыть" и удалены избыточные голосовые объявления (например, "Открывается меню...") для более плавной работы.

## Изменения в версии 2.8
* Добавлен итальянский перевод.
* **Отчёт о состоянии:** Добавлена новая команда (NVDA+Control+Shift+I) для озвучивания текущего статуса дополнения (например, "Загрузка...", "Анализ...").
* **Экспорт HTML:** Кнопка "Сохранить содержимое" в диалогах результатов теперь сохраняет вывод в виде форматированного HTML-файла, сохраняя стили, такие как заголовки и жирный текст.
* **Интерфейс настроек:** Улучшена компоновка панели настроек с доступной группировкой.
* **Новые модели:** Добавлена поддержка gemini-flash-latest и gemini-flash-lite-latest.
* **Языки:** Добавлен непальский в список поддерживаемых языков.
* **Логика меню улучшения:** Исправлена критическая ошибка, из-за которой команды "Улучшить текст" могли не работать, если язык интерфейса NVDA не был английским.
* **Диктант:** Улучшено обнаружение тишины для предотвращения некорректного вывода текста при отсутствии речи на входе.
* **Настройки обновления:** Опция "Проверять обновления при запуске" теперь по умолчанию отключена в соответствии с политиками Магазина дополнений.
* Очистка кода.

## Изменения в версии 2.7
* Структура проекта мигрирована на официальный шаблон дополнений NV Access для лучшего соответствия стандартам.
* Реализована логика автоматического повторного запроса при ошибках HTTP 429 (Превышен лимит запросов) для обеспечения надёжности во время высокой нагрузки.
* Оптимизированы запросы на перевод для более высокой точности и лучшей обработки логики "Умной замены".
* Обновлён русский перевод.

## Изменения в версии 2.6
* Добавлена поддержка русского перевода (благодаря nvda-ru).
* Обновлены сообщения об ошибках для предоставления более описательной обратной связи относительно подключения.
* Язык перевода по умолчанию изменён на английский.

## Изменения в версии 2.5
* Добавлена Нативная команда OCR файла (NVDA+Control+Shift+F).
* Добавлена кнопка "Сохранить чат" в диалоги результатов.
* Реализована полная поддержка локализации (i18n).
* Аудиообратная связь переведена на использование нативного модуля звуков NVDA.
* Переход на File API Gemini для лучшей обработки PDF и аудиофайлов.
* Исправлен сбой при переводе текста, содержащего фигурные скобки.

## Изменения в версии 2.1.1
* Исправлена проблема, при которой переменная `[file_ocr]` некорректно работала внутри Пользовательских запросов.

## Изменения в версии 2.1
* Все сочетания клавиш стандартизированы для использования NVDA+Control+Shift, чтобы исключить конфликты с ноутбучной раскладкой NVDA и системными горячими клавишами.

## Изменения в версии 2.0
* Реализована встроенная система автоматического обновления.
* Добавлен Кэш умного перевода для мгновенного извлечения ранее переведённого текста.
* Добавлена Память беседы для контекстного уточнения результатов в диалогах чата.
* Добавлена Специальная команда перевода из буфера обмена (NVDA+Control+Shift+Y).
* Оптимизированы запросы ИИ для строгого соблюдения вывода на целевом языке.
* Исправлен сбой, вызванный специальными символами во входном тексте.

## Изменения в версии 1.5
* Добавлена поддержка более 20 новых языков.
* Реализован Интерактивный диалог улучшения для уточняющих вопросов.
* Добавлена Нативная функция Умного диктанта.
* Добавлена категория "Vision Assistant" в диалог "Жесты ввода" NVDA.
* Исправлены сбои COMError в определённых приложениях, таких как Firefox и Word.
* Добавлен механизм автоматического повтора при ошибках сервера.

## Изменения в версии 1.0
* Первый выпуск.
